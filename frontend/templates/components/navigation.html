<!-- Navigation Header -->
<header class="sticky top-0 z-40 backdrop-blur bg-[rgba(2,6,11,0.45)] border-b border-slate-800">
  <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
    <a href="{{ url_for('pages.dashboard') }}" class="flex items-center gap-3">
      <!-- VediSpeak Lotus Logo -->
      <div class="w-11 h-11 flex items-center justify-center">
        <img src="{{ url_for('static', filename='images/vedispeak-logo.png') }}" 
             alt="VediSpeak Logo" 
             class="w-11 h-11 object-contain">
      </div>
      <div>
        <div class="text-sm font-semibold text-amber-200 leading-none">VediSpeak</div>
        <div class="text-xs text-[--muted]">Learn • Speak • Rise</div>
      </div>
    </a>

    <nav class="hidden lg:flex items-center gap-6 text-sm text-slate-200">
      <a href="{{ url_for('pages.dashboard') }}" class="{% if active_page == 'dashboard' %}text-white font-semibold{% else %}hover:text-white transition{% endif %}">Home</a>
      <a href="{{ url_for('pages.stt_tts') }}" class="{% if active_page == 'stt-tts' %}text-white font-semibold{% else %}hover:text-white transition{% endif %}">Tools</a>
      <a href="{{ url_for('pages.learn') }}" class="{% if active_page == 'learn' %}text-white font-semibold{% else %}hover:text-white transition{% endif %}">Learn</a>
      <a href="{{ url_for('pages.about_us') }}" class="{% if active_page == 'about_us' %}text-white font-semibold{% else %}hover:text-white transition{% endif %}">About</a>
      {% if active_page == 'user_profile' or active_page == 'test_profile' or active_page == 'settings' %}
      <a href="{{ url_for('profile.user_profile') }}" class="text-white font-semibold">Profile</a>
      {% endif %}
    </nav>

    <!-- User Profile Section (when logged in) -->
    <div class="flex items-center gap-3">
      <button class="p-2 rounded-full hover:bg-white/5 transition" aria-label="Notifications">
        <i class="fa-regular fa-bell text-[--muted] hover:text-white transition"></i>
      </button>
      
      <!-- User Profile Dropdown -->
      <div class="relative group">
        <button class="flex items-center gap-3 bg-[rgba(255,255,255,0.03)] px-3 py-2 rounded-full hover:bg-[rgba(255,255,255,0.06)] transition" aria-label="User menu">
          <!-- Dynamic Profile Photo -->
          <div class="w-8 h-8 rounded-full overflow-hidden border-2 border-amber-400/20">
            {% if user and user.profile_photo %}
              <img src="{{ url_for('pages.uploaded_file', filename=user.profile_photo) }}" 
                   alt="Profile" 
                   class="w-full h-full object-cover"
                   id="navProfilePhoto"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div class="w-full h-full bg-gradient-to-tr from-amber-400 to-orange-400 flex items-center justify-center text-sm font-semibold" style="display: none;">
                {{ (user.username or session.username or 'User')[0].upper() }}
              </div>
            {% else %}
              <div class="w-full h-full bg-gradient-to-tr from-amber-400 to-orange-400 flex items-center justify-center text-sm font-semibold">
                {{ (user.username or session.username or 'User')[0].upper() }}
              </div>
            {% endif %}
          </div>
          <span class="text-sm font-medium">{{ user.username or session.username or 'User' }}</span>
          <i class="fa-solid fa-chevron-down text-xs text-[--muted]"></i>
        </button>
        
        <!-- Dropdown Menu -->
        <div class="absolute right-0 top-full mt-2 w-48 glass rounded-xl py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <a href="{{ url_for('profile.user_profile') }}" class="flex items-center gap-3 px-4 py-2 text-sm hover:bg-white/5 transition">
            <i class="fa-solid fa-user text-[--muted]"></i>
            View Profile
          </a>
          <a href="{{ url_for('profile.settings') }}" class="flex items-center gap-3 px-4 py-2 text-sm hover:bg-white/5 transition">
            <i class="fa-solid fa-cog text-[--muted]"></i>
            Settings
          </a>
          <a href="{{ url_for('pages.ml_diagnostics') }}" class="flex items-center gap-3 px-4 py-2 text-sm hover:bg-white/5 transition">
            <i class="fa-solid fa-brain text-[--muted]"></i>
            ML Diagnostics
          </a>
          <a href="{{ url_for('pages.learn') }}" class="flex items-center gap-3 px-4 py-2 text-sm hover:bg-white/5 transition">
            <i class="fa-solid fa-graduation-cap text-[--muted]"></i>
            My Learning
          </a>
          <div class="border-t border-white/10 my-2"></div>
          <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-3 px-4 py-2 text-sm hover:bg-white/5 transition text-red-400">
            <i class="fa-solid fa-sign-out-alt text-red-400"></i>
            Sign Out
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Right Sidebar (for profile pages) -->
{% if show_sidebar %}
<aside class="sidebar">
  <a class="sb-item {% if active_page == 'dashboard' %}active{% endif %}" href="{{ url_for('pages.dashboard') }}"><i class="fa-solid fa-chart-simple text-amber-200 text-xl"></i></a>
  <a class="sb-item {% if active_page == 'stt-tts' %}active{% endif %}" href="{{ url_for('pages.stt_tts') }}"><i class="fa-solid fa-microphone text-sky-300 text-xl"></i></a>
  <a class="sb-item {% if active_page == 'learn' %}active{% endif %}" href="{{ url_for('pages.learn') }}"><i class="fa-solid fa-graduation-cap text-indigo-300 text-xl"></i></a>
  <a class="sb-item {% if active_page == 'user_profile' or active_page == 'settings' %}active{% endif %}" href="{{ url_for('profile.user_profile') }}"><i class="fa-solid fa-user text-emerald-300 text-xl"></i></a>
  <a class="sb-item" href="{{ url_for('auth.logout') }}"><i class="fa-solid fa-right-from-bracket text-[--muted] text-xl"></i></a>
</aside>

<style>
/* Glass effect for dropdown */
.glass {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(6px);
  border-radius: 14px;
}

.sidebar {
  width:84px;
  position:fixed;
  right:22px;
  top:120px;
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:60;
}

.sb-item {
  width:64px; height:64px;
  display:flex; align-items:center; justify-content:center;
  border-radius:12px;
  background: rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.03);
  transition: transform .18s, box-shadow .18s;
  cursor:pointer;
}

.sb-item:hover{
  transform: translateY(-6px) scale(1.02);
  box-shadow:0 8px 30px rgba(99,102,241,0.06);
}

.sb-item.active{
  background: linear-gradient(180deg, rgba(185,131,74,0.06), rgba(185,131,74,0.02));
  box-shadow:0 10px 40px rgba(185,131,74,0.12);
  border-color: rgba(185,131,74,0.14);
}

@media (max-width: 900px) {
  .sidebar { display:none; }
}
</style>

<!-- Profile Photo Update Script -->
<script>
// Function to update profile photo in navbar
function updateNavbarProfilePhoto(photoUrl) {
  const navProfilePhoto = document.getElementById('navProfilePhoto');
  const fallbackDiv = navProfilePhoto ? navProfilePhoto.nextElementSibling : null;
  
  if (navProfilePhoto && photoUrl) {
    navProfilePhoto.src = photoUrl;
    navProfilePhoto.style.display = 'block';
    if (fallbackDiv) fallbackDiv.style.display = 'none';
  } else if (fallbackDiv) {
    if (navProfilePhoto) navProfilePhoto.style.display = 'none';
    fallbackDiv.style.display = 'flex';
  }
}

// Listen for profile photo updates from other pages
window.addEventListener('profilePhotoUpdated', function(event) {
  updateNavbarProfilePhoto(event.detail.photoUrl);
});

// Check for profile photo updates on page load
document.addEventListener('DOMContentLoaded', function() {
  // Check if there's a stored profile photo URL
  const storedPhotoUrl = localStorage.getItem('userProfilePhoto');
  if (storedPhotoUrl) {
    updateNavbarProfilePhoto(storedPhotoUrl);
  }
});
</script>
{% endif %}