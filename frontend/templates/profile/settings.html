<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settings — VediSpeak</title>
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Socket.IO -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    :root {
      --bg-1: #0b1220;
      --card: #0f1724;
      --accent: #b9834a;
      --muted: #98a0a6;
    }
    
    body {
      background: linear-gradient(180deg, var(--bg-1) 0%, #07101a 100%);
      color: #e6eef6;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto;
    }
    
    .glass {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(6px);
      border-radius: 14px;
    }
    
    .cta {
      background: linear-gradient(135deg, var(--accent) 0%, #d4a574 100%);
      color: #0b1220;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(185, 131, 74, 0.3);
    }
    
    .stat-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      background: rgba(255,255,255,0.04);
      border-color: rgba(185, 131, 74, 0.2);
    }
    
    .progress-ring {
      transform: rotate(-90deg);
    }
    
    .progress-ring-circle {
      transition: stroke-dashoffset 0.35s;
      transform-origin: 50% 50%;
    }
    
    .upload-area {
      border: 2px dashed rgba(185, 131, 74, 0.3);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .upload-area:hover {
      border-color: rgba(185, 131, 74, 0.6);
      background: rgba(185, 131, 74, 0.05);
    }
    
    .upload-area.dragover {
      border-color: var(--accent);
      background: rgba(185, 131, 74, 0.1);
    }
  </style>
</head>

<body class="min-h-screen antialiased">
  {% include 'components/navigation.html' %}
  
  <div class="max-w-6xl mx-auto px-6 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-white mb-2">Account Settings</h1>
      <p class="text-slate-400">Manage your profile, preferences, and account security</p>
    </div>
    
    <!-- Settings Navigation Tabs -->
    <div class="mb-8">
      <div class="border-b border-slate-700">
        <nav class="flex space-x-8">
          <button class="settings-tab active" data-tab="profile">
            <i class="fas fa-user mr-2"></i>Profile
          </button>
          <button class="settings-tab" data-tab="account">
            <i class="fas fa-cog mr-2"></i>Account
          </button>
          <button class="settings-tab" data-tab="preferences">
            <i class="fas fa-sliders-h mr-2"></i>Preferences
          </button>
          <button class="settings-tab" data-tab="notifications">
            <i class="fas fa-bell mr-2"></i>Notifications
          </button>
          <button class="settings-tab" data-tab="privacy">
            <i class="fas fa-shield-alt mr-2"></i>Privacy
          </button>
        </nav>
      </div>
    </div>

    <!-- Settings Content -->
    <div class="space-y-8">
      <!-- Profile Tab -->
      <div class="settings-content active" id="profile-tab">
        <!-- Profile Photo Upload -->
        <div class="glass p-6">
          <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-camera text-accent"></i>
            Profile Photo
          </h2>
          
          <div class="flex items-start gap-6">
            <!-- Current Photo -->
            <div class="flex-shrink-0">
              <div class="w-24 h-24 rounded-full overflow-hidden bg-gradient-to-tr from-accent to-orange-400 flex items-center justify-center">
                {% if user.profile_photo and user.profile_photo != 'default.png' %}
                  <img src="/storage/uploads/{{ user.profile_photo }}" alt="Profile" class="w-full h-full object-cover" id="currentProfilePhoto">
                {% else %}
                  <span class="text-2xl font-bold text-white" id="profileInitial">{{ (user.username or 'U')[0].upper() }}</span>
                {% endif %}
              </div>
            </div>
            
            <!-- Upload Area -->
            <div class="flex-1">
              <div class="upload-area" id="uploadArea">
                <input type="file" id="photoInput" accept="image/*" class="hidden">
                <i class="fas fa-cloud-upload-alt text-3xl text-accent mb-3"></i>
                <p class="text-white font-medium mb-1">Click to upload or drag and drop</p>
                <p class="text-sm text-slate-400">PNG, JPG, JPEG, WebP up to 8MB</p>
              </div>
              
              <!-- Upload Progress -->
              <div id="uploadProgress" class="hidden mt-4">
                <div class="bg-slate-700 rounded-full h-2">
                  <div class="bg-accent h-2 rounded-full transition-all duration-300" style="width: 0%" id="progressBar"></div>
                </div>
                <p class="text-sm text-slate-400 mt-2" id="uploadStatus">Uploading...</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Profile Information -->
        <div class="glass p-6">
          <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-user text-accent"></i>
            Profile Information
          </h2>
          
          <form id="profileForm" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Username</label>
                <input type="text" name="username" value="{{ user.username or '' }}" 
                       class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white focus:border-accent focus:outline-none">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Email</label>
                <input type="email" value="{{ user.email or '' }}" disabled
                       class="w-full px-4 py-3 bg-slate-800/30 border border-slate-600 rounded-lg text-slate-400 cursor-not-allowed">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Profession</label>
              <input type="text" name="profession" value="{{ user.profession or '' }}" 
                     class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white focus:border-accent focus:outline-none">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Bio</label>
              <textarea name="bio" rows="4" 
                        class="w-full px-4 py-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white focus:border-accent focus:outline-none">{{ user.bio or '' }}</textarea>
            </div>
            
            <button type="submit" class="cta">
              <i class="fas fa-save"></i>
              Save Changes
            </button>
          </form>
        </div>
        
        <!-- Learning Analytics -->
        <div class="glass p-6">
          <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-chart-line text-accent"></i>
            Learning Analytics
          </h2>
          
          <!-- Overall Progress Stats -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="stat-card text-center">
              <div class="text-2xl font-bold text-emerald-400" id="totalCourses">{{ learning_stats.total_courses or 0 }}</div>
              <div class="text-xs text-slate-400">Courses Enrolled</div>
            </div>
            <div class="stat-card text-center">
              <div class="text-2xl font-bold text-blue-400" id="completedModules">{{ learning_stats.total_modules_completed or 0 }}</div>
              <div class="text-xs text-slate-400">Modules Completed</div>
            </div>
            <div class="stat-card text-center">
              <div class="text-2xl font-bold text-purple-400" id="totalHours">{{ (learning_stats.total_time_minutes or 0) // 60 }}</div>
              <div class="text-xs text-slate-400">Hours Studied</div>
            </div>
            <div class="stat-card text-center">
              <div class="text-2xl font-bold text-orange-400" id="avgProgress">{{ learning_stats.avg_progress or 0 }}%</div>
              <div class="text-xs text-slate-400">Avg Progress</div>
            </div>
          </div>
          
          <!-- Weekly Progress Chart -->
          <div class="h-64 mb-6">
            <canvas id="weeklyChart"></canvas>
          </div>
          
          <!-- Course Progress Overview -->
          <div class="space-y-3">
            <h3 class="text-lg font-semibold text-white">Course Progress</h3>
            <div id="courseProgressList" class="space-y-2">
              <!-- Course progress items will be loaded dynamically -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Column: Stats & Activity -->
      <div class="space-y-8">
        <!-- Streak Details -->
        <div class="glass p-6">
          <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-fire text-accent"></i>
            Streak Status
          </h2>
          
          <!-- Circular Progress -->
          <div class="flex justify-center mb-6">
            <div class="relative w-32 h-32">
              <svg class="progress-ring w-32 h-32">
                <circle class="progress-ring-circle" stroke="rgba(185,131,74,0.2)" stroke-width="8" 
                        fill="transparent" r="56" cx="64" cy="64"/>
                <circle class="progress-ring-circle" stroke="var(--accent)" stroke-width="8" 
                        fill="transparent" r="56" cx="64" cy="64" 
                        stroke-dasharray="351.86" 
                        stroke-dashoffset="{{ 351.86 - (351.86 * (streak_data.streak_percentage or 0) / 100) }}"
                        id="streakProgress"/>
              </svg>
              <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center">
                  <div class="text-2xl font-bold text-white">{{ streak_data.current_streak or 0 }}</div>
                  <div class="text-xs text-slate-400">days</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-slate-300">This Week</span>
              <span class="text-white font-medium">{{ streak_data.week_active_days or 0 }}/7 days</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-slate-300">This Month</span>
              <span class="text-white font-medium">{{ streak_data.month_active_days or 0 }}/30 days</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-slate-300">Best Streak</span>
              <span class="text-accent font-medium">{{ streak_data.longest_streak or 0 }} days</span>
            </div>
          </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="glass p-6">
          <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-history text-accent"></i>
            Recent Activity
          </h2>
          
          <div class="space-y-4" id="recentActivities">
            {% for activity in activities[:5] %}
            <div class="flex items-center gap-3 p-3 bg-slate-800/30 rounded-lg">
              <div class="w-8 h-8 bg-accent/20 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-{{ 'graduation-cap' if activity.activity_type == 'study' else 'tasks' }} text-accent text-sm"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm text-white truncate">{{ activity.description or 'Activity logged' }}</p>
                <p class="text-xs text-slate-400">{{ activity.created_at.strftime('%H:%M') if activity.created_at else 'Recently' }}</p>
              </div>
              {% if activity.xp_earned %}
              <span class="text-xs bg-accent/20 text-accent px-2 py-1 rounded-full">+{{ activity.xp_earned }} XP</span>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          
          <button class="w-full mt-4 text-sm text-accent hover:text-white transition-colors">
            View All Activity
          </button>
        </div>
        
        <!-- Portfolio Links -->
        <div class="glass p-6">
          <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-3">
            <i class="fas fa-link text-accent"></i>
            Portfolio Links
          </h2>
          
          <div class="space-y-3" id="portfolioLinks">
            {% for link in links %}
            <div class="flex items-center justify-between p-3 bg-slate-800/30 rounded-lg">
              <div class="flex items-center gap-3">
                <i class="fab fa-{{ link.platform.lower() }} text-accent"></i>
                <span class="text-sm text-white">{{ link.platform }}</span>
              </div>
              <a href="{{ link.url }}" target="_blank" class="text-accent hover:text-white transition-colors">
                <i class="fas fa-external-link-alt text-sm"></i>
              </a>
            </div>
            {% endfor %}
          </div>
          
          <button class="w-full mt-4 text-sm text-accent hover:text-white transition-colors" onclick="addPortfolioLink()">
            <i class="fas fa-plus mr-2"></i>Add Link
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Socket.IO connection
    const socket = io();
    
    // Join user's room for real-time updates
    socket.emit('join_profile_room', {user_id: {{ session.user_id }}});
    
    // Profile photo upload functionality
    const uploadArea = document.getElementById('uploadArea');
    const photoInput = document.getElementById('photoInput');
    const uploadProgress = document.getElementById('uploadProgress');
    const progressBar = document.getElementById('progressBar');
    const uploadStatus = document.getElementById('uploadStatus');
    const currentProfilePhoto = document.getElementById('currentProfilePhoto');
    const profileInitial = document.getElementById('profileInitial');
    
    // Click to upload
    uploadArea.addEventListener('click', () => photoInput.click());
    
    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handlePhotoUpload(files[0]);
      }
    });
    
    photoInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handlePhotoUpload(e.target.files[0]);
      }
    });
    
    function handlePhotoUpload(file) {
      // Validate file type
      const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/webp'];
      if (!allowedTypes.includes(file.type)) {
        alert('Please select a PNG, JPG, JPEG, or WebP image file.');
        return;
      }
      
      // Validate file size (8MB)
      if (file.size > 8 * 1024 * 1024) {
        alert('File size must be less than 8MB.');
        return;
      }
      
      const formData = new FormData();
      formData.append('profile_photo', file);
      
      // Show progress
      uploadProgress.classList.remove('hidden');
      progressBar.style.width = '0%';
      uploadStatus.textContent = 'Uploading...';
      
      // Upload with progress
      const xhr = new XMLHttpRequest();
      
      xhr.upload.addEventListener('progress', (e) => {
        if (e.lengthComputable) {
          const percentComplete = (e.loaded / e.total) * 100;
          progressBar.style.width = percentComplete + '%';
        }
      });
      
      xhr.addEventListener('load', () => {
        uploadProgress.classList.add('hidden');
        
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          if (response.success) {
            // Update profile photo
            if (currentProfilePhoto) {
              currentProfilePhoto.src = response.photo_url;
            } else if (profileInitial) {
              // Replace initial with image
              profileInitial.parentElement.innerHTML = `<img src="${response.photo_url}" alt="Profile" class="w-full h-full object-cover" id="currentProfilePhoto">`;
            }
            
            // Show success message
            showNotification('Profile photo updated successfully!', 'success');
          } else {
            showNotification(response.error || 'Upload failed', 'error');
          }
        } else {
          showNotification('Upload failed. Please try again.', 'error');
        }
      });
      
      xhr.addEventListener('error', () => {
        uploadProgress.classList.add('hidden');
        showNotification('Upload failed. Please check your connection.', 'error');
      });
      
      xhr.open('POST', '/api/profile/upload_photo');
      xhr.send(formData);
    }
    
    // Profile form submission
    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      try {
        const response = await fetch('/api/profile/update', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          showNotification('Profile updated successfully!', 'success');
        } else {
          showNotification(result.error || 'Update failed', 'error');
        }
      } catch (error) {
        showNotification('Update failed. Please try again.', 'error');
      }
    });
    
    // Initialize learning analytics
    initializeLearningAnalytics();
    
    function initializeLearningAnalytics() {
      // Load course progress
      loadCourseProgress();
      
      // Initialize weekly chart
      initializeWeeklyChart();
      
      // Load real-time stats
      loadLearningStats();
    }
    
    function loadCourseProgress() {
      fetch('/api/courses')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            displayCourseProgress(data.courses);
          }
        })
        .catch(error => console.error('Error loading course progress:', error));
    }
    
    function displayCourseProgress(courses) {
      const container = document.getElementById('courseProgressList');
      container.innerHTML = '';
      
      courses.forEach(course => {
        const progress = course.user_progress ? course.user_progress.progress_percentage : 0;
        const isCompleted = course.user_progress ? course.user_progress.is_completed : false;
        
        const courseItem = document.createElement('div');
        courseItem.className = 'flex items-center justify-between p-3 bg-slate-800/30 rounded-lg';
        courseItem.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-${isCompleted ? 'emerald' : 'blue'}-500/20 flex items-center justify-center">
              <i class="fas fa-${isCompleted ? 'check' : 'book'} text-${isCompleted ? 'emerald' : 'blue'}-400 text-sm"></i>
            </div>
            <div>
              <div class="text-sm font-medium text-white">${course.title}</div>
              <div class="text-xs text-slate-400">${course.level} • ${course.total_modules} modules</div>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="text-sm text-slate-300">${Math.round(progress)}%</div>
            <div class="w-16 bg-slate-700 rounded-full h-2">
              <div class="bg-${isCompleted ? 'emerald' : 'blue'}-500 h-2 rounded-full transition-all duration-500" 
                   style="width: ${progress}%"></div>
            </div>
          </div>
        `;
        container.appendChild(courseItem);
      });
    }
    
    function loadLearningStats() {
      fetch('/api/progress/user')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            updateLearningStats(data.stats);
          }
        })
        .catch(error => console.error('Error loading learning stats:', error));
    }
    
    function updateLearningStats(stats) {
      document.getElementById('totalCourses').textContent = stats.total_courses || 0;
      document.getElementById('completedModules').textContent = stats.total_modules_completed || 0;
      document.getElementById('totalHours').textContent = Math.round((stats.total_time_minutes || 0) / 60);
      document.getElementById('avgProgress').textContent = Math.round(stats.avg_progress || 0) + '%';
    }
    
    function initializeWeeklyChart() {
      const ctx = document.getElementById('weeklyChart').getContext('2d');
      
      // Get recent activity data
      fetch('/api/progress/user')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            const recentActivity = data.stats.recent_activity || [];
            const weeklyData = processWeeklyData(recentActivity);
            
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                  label: 'Study Hours',
                  data: weeklyData,
                  borderColor: '#b9834a',
                  backgroundColor: 'rgba(185, 131, 74, 0.1)',
                  tension: 0.4,
                  fill: true,
                  pointBackgroundColor: '#b9834a',
                  pointBorderColor: '#ffffff',
                  pointBorderWidth: 2,
                  pointRadius: 4
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                  legend: {
                    display: false
                  },
                  tooltip: {
                    backgroundColor: 'rgba(15, 23, 36, 0.9)',
                    titleColor: '#ffffff',
                    bodyColor: '#e6eef6',
                    borderColor: '#b9834a',
                    borderWidth: 1
                  }
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    grid: {
                      color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                      color: '#98a0a6',
                      callback: function(value) {
                        return value + 'h';
                      }
                    }
                  },
                  x: {
                    grid: {
                      color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                      color: '#98a0a6'
                    }
                  }
                }
              }
            });
          }
        })
        .catch(error => {
          console.error('Error loading weekly data:', error);
          // Fallback to empty chart
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
              datasets: [{
                label: 'Study Hours',
                data: [0, 0, 0, 0, 0, 0, 0],
                borderColor: '#b9834a',
                backgroundColor: 'rgba(185, 131, 74, 0.1)',
                tension: 0.4,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: {
                y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#98a0a6' } },
                x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#98a0a6' } }
              }
            }
          });
        });
    }
    
    function processWeeklyData(recentActivity) {
      const weekDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const weeklyHours = [0, 0, 0, 0, 0, 0, 0];
      
      // Get current week dates
      const now = new Date();
      const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
      const mondayDate = new Date(now);
      mondayDate.setDate(now.getDate() - (currentDay === 0 ? 6 : currentDay - 1));
      
      recentActivity.forEach(activity => {
        const activityDate = new Date(activity.date);
        const daysDiff = Math.floor((activityDate - mondayDate) / (1000 * 60 * 60 * 24));
        
        if (daysDiff >= 0 && daysDiff < 7) {
          // Estimate hours from modules (15 minutes per module)
          const hours = (activity.modules || 0) * 0.25;
          weeklyHours[daysDiff] += hours;
        }
      });
      
      return weeklyHours;
    }
    
    // Real-time updates
    socket.on('profile_photo_updated', (data) => {
      if (data.user_id === {{ session.user_id }}) {
        // Update photo in real-time
        const img = document.getElementById('currentProfilePhoto');
        if (img) {
          img.src = data.photo_url + '?t=' + Date.now(); // Cache bust
        }
      }
    });
    
    socket.on('stats_updated', (data) => {
      if (data.user_id === {{ session.user_id }}) {
        // Update stats in real-time
        document.getElementById('totalHours').textContent = data.stats.total_hours || 0;
        document.getElementById('currentStreak').textContent = data.stats.streak_days || 0;
        document.getElementById('completedTasks').textContent = data.stats.completed_tasks || 0;
        document.getElementById('activeSessions').textContent = data.stats.active_sessions || 0;
      }
    });
    
    // Utility functions
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
        type === 'success' ? 'bg-green-600' : 
        type === 'error' ? 'bg-red-600' : 'bg-blue-600'
      } text-white`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Auto remove after 3 seconds
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    function addPortfolioLink() {
      const platform = prompt('Platform name (e.g., GitHub, LinkedIn):');
      const url = prompt('URL:');
      
      if (platform && url) {
        // Add portfolio link via API
        fetch('/add_link', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `platform=${encodeURIComponent(platform)}&url=${encodeURIComponent(url)}`
        }).then(() => {
          location.reload(); // Refresh to show new link
        });
      }
    }
    
    // Auto-refresh stats every 30 seconds
    setInterval(() => {
      socket.emit('request_stats_update');
    }, 30000);
  </script>
</body>
</html>